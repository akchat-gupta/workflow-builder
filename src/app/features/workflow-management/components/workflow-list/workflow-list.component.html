<!-- Main container for the editor page -->
<div class="max-w-4xl mx-auto p-8">
  <h1 class="text-3xl font-bold mb-6">Workflow Editor</h1>

  <!-- ðŸ‘‡ THE <form> TAG STARTS HERE and now wraps everything ðŸ‘‡ -->
  <form [formGroup]="workflowForm">
    
    <!-- This section for workflow details does not change -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
      <h2 class="text-xl font-semibold mb-4">Workflow Details</h2>
      <div class="space-y-4">
        <div>
          <label for="workflowName" class="block text-sm font-medium text-gray-700">Workflow Name</label>
          <input type="text" id="workflowName" formControlName="name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        <div>
          <label for="workflowDescription" class="block text-sm font-medium text-gray-700">Description</label>
          <textarea id="workflowDescription" rows="3" formControlName="description" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
        </div>
      </div>
    </div>

    <!-- This section for workflow steps is now INSIDE the <form> tag -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Steps</h2>
        <button type="button" (click)="onAddStep()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
          Add Step
        </button>
      </div>

      <!-- The formArrayName directive can now find its parent formGroup -->
      <div formArrayName="steps" class="space-y-4">
        <div *ngFor="let stepControl of steps.controls; let i = index" [formGroupName]="i" class="p-4 border rounded-md relative">
          <!-- ... all your step input fields ... -->
          <div class="flex justify-between items-center mb-2">
            <h3 class="text-lg font-semibold">Step {{ i + 1 }}</h3>
            <button type="button" (click)="onDeleteStep(i)" class="text-red-500 hover:text-red-700 font-medium">Delete</button>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Title</label>
            <input type="text" formControlName="title" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"/>
          </div>
          <div class="mt-2">
            <label class="block text-sm font-medium text-gray-700">Description</label>
            <textarea rows="2" formControlName="description" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
          </div>
        </div>
        <p *ngIf="steps.length === 0" class="text-gray-500 text-center py-4">No steps yet. Click "Add Step" to begin.</p>
      </div>
    </div>

  </form> 
  <!--  ðŸ‘† THE </form> TAG NOW ENDS HERE, WRAPPING BOTH SECTIONS -->

</div>